<chapter id="logmanager_logapp_management">
	<title>Log Application Management</title>
	<para>Log Application 이라함은 로그를 관리할 대상 웹 어플리케이션을 의미한다.</para>
	<para>Log Manager 1.5.0 버전부터 Log Application 은 별도의 Log Agent를 기반으로 관리되므로 'Log Application Management' 역시 많은 기능이 변경되었다.</para>
	<para>Log Manager 1.5.0 버전부터 'Log Application Management'에서는 좀 더 강력한 Log 정책 관리 기능을 제공한다. 이는 <link linkend="log_policy_editor">'로그 정책 관리'</link>라는 항목으로 별도 설명한다.</para>
	<para>로그 어플리케이션의 주요 기능은 다음과 같다.</para>
	<itemizedlist>
		<listitem><para>로그 어플리케이션의 등록/수정/삭제</para></listitem>
		<listitem><para>로그 어플리케이션의 로그들의 조회권한(Administrator/Developer) 설정</para></listitem>
		<listitem><para>로그 어플리케이션 Status 관리(Active/Inactive/Failed)</para></listitem>
		<listitem><para>로그 어플리케이션의 로그 정책 변경</para></listitem>
	</itemizedlist>
	<section id="logmanager_logapp_list">
		<title>Log Application 목록</title>
		<para>다음은 로그 어플리케이션의 목록화면이다.</para>
		<para>로그 어플리케이션의 목록화면에서는 다음과 같은 기능을 제공한다.</para>
		<itemizedlist>
			<listitem><para>로그 어플리케이션의 등록 화면 호출</para></listitem>
			<listitem><para>로그 어플리케이션의 상세조회 및 수정화면 호출</para></listitem>
			<listitem><para>로그 어플리케이션 Status 관리 : Active to Inactive, Inactive to Active</para></listitem>
			<listitem><para>로그 정책 관리 화면 호출</para></listitem>
			<listitem><para>로그 어플리케이션의 삭제</para></listitem>
		</itemizedlist>
		<mediaobject>
			<imageobject role="html">
				<imagedata fileref="../image/logmanager/logmanager019.jpg" align="center" />
			</imageobject>
			<imageobject role="fo">
				<imagedata fileref="../image/logmanager/pdf/logmanager019.jpg" align="center" />
			</imageobject>
			<caption>Log Application List</caption>
		</mediaobject>
		<note>
			<title>Log Application Status</title>
			<para>로그 어플리케이션의 status는 'Log Analysis'화면에서의 로그 데이타 조회시 조회가능여부를 결정할 때 사용되는 것으로 Active 상태이면 조회가능하다는 의미로 보면 된다.</para>
		</note>
	</section>
	<section id="logmanager_logapp_add">
		<title>Log Application 등록</title>
		<para>다음은 로그 어플리케이션의 등록화면이다.</para>
		<para>등록화면은 목록 우측 하단의 'Add' 버튼을 클릭하면 표시된다.</para>
		<para>다음은 로그 어플리케이션의 등록 방법에 대한 설명이다.</para>
		<itemizedlist>
			<listitem><para>로그 어플리케이션의 아이디 입력(웹 어플리케이션의 Context Name과 동일해야 함)</para></listitem>
			<listitem><para>담당 Agent를 선택 후 로그 어플리케이션의 log4j.xml 경로 입력(접근 가능한 UNC 경로만 입력가능, 상대경로 불가)</para></listitem>
			<listitem><para>'Load' 버튼을 통한 어플리케이션 로그 정책 정보 Loading(그림 Log Application Regist Form 2 참조)</para></listitem>
			<listitem><para>Agent 를 통해 해당 어플리케이션의 log4j.xml 정보를 분석하여 그림과 같이 관리 가능한 Appender 목록이 표시된다.</para></listitem>
			<listitem><para>'MongoDBPatternLayoutAppender'을 통하여 직접 MongoDB에 로그를 저장하는 경우는 'Harvest'항목이 체크 상태에서 disabled 되어 표시된다. 이 상태에서는 Polling Time 설정이 불가능하며, Monitor Level 만 설정할 수 있다.</para></listitem>
			<listitem><para>Monitor Level을 설정하면 'Log Analysis' 화면 상에서 로그데이타를 조회할 수 있는 권한을 제한할 수 있다.</para></listitem>
			<listitem><para>Log Agent를 통해 로그를 수집하는 경우에는 Harvest 항목을 체크하고 로그데이타를 수집할 주기(polling time) 을 설정한다. 단, 해당 Appender가 파일 형태로 로그를 출력하는 경우에만 로그데이타 수집이 가능하다.</para></listitem>
			<listitem><para>'Save' 버튼을 클릭하여 Log Application을 등록한다.</para></listitem>
		</itemizedlist>
		<para><mediaobject>
			<imageobject role="html">
				<imagedata fileref="../image/logmanager/logmanager021.jpg" align="center" />
			</imageobject>
			<imageobject role="fo">
				<imagedata fileref="../image/logmanager/pdf/logmanager021.jpg" align="center" />
			</imageobject>
			<caption>Log Application Regist Form 1</caption>
		</mediaobject></para>
		<para><mediaobject>
			<imageobject role="html">
				<imagedata fileref="../image/logmanager/logmanager022.jpg" align="center" />
			</imageobject>
			<imageobject role="fo">
				<imagedata fileref="../image/logmanager/pdf/logmanager022.jpg" align="center" />
			</imageobject>
			<caption>Log Application Regist Form 2</caption>
		</mediaobject></para>
		<note>
			<title>Log Application 수정</title>
			<para>수정 및 상세 조회의 경우 어플리케이션 아이디 변경만 불가능하고 나머지 기능은 동일하다</para>
			<para>또한 해당 어플리케이션의 Agent가 Offline(=Inactive) 상태인 경우 수정은 불가능하며 조회만 가능하다. 그리고 화면상에 해당 Agent가 'Offline' 임을 표시해 준다.(그림 Log Application Update Form(Offline) 참조)</para>
			<para>
				<mediaobject>
					<imageobject role="html">
						<imagedata fileref="../image/logmanager/logmanager020.jpg" align="center" />
					</imageobject>
					<imageobject role="fo">
						<imagedata fileref="../image/logmanager/pdf/logmanager020.jpg" align="center" />
					</imageobject>
					<caption>Log Application Update Form(Online)</caption>
				</mediaobject>
			</para>
			<para>
				<mediaobject>
					<imageobject role="html">
						<imagedata fileref="../image/logmanager/logmanager023.jpg" align="center" />
					</imageobject>
					<imageobject role="fo">
						<imagedata fileref="../image/logmanager/pdf/logmanager023.jpg" align="center" />
					</imageobject>
					<caption>Log Application Update Form(Offline)</caption>
				</mediaobject>
			</para>
		</note>
	</section>
	<section id="log_policy_editor">
		<title>Log Application 로그 정책(log4j.xml) 관리</title>
		<para>Log Manager 1.5.0 부터는 Log Application의 등록/수정과 해당 어플리케이션의 로그 정책관리 기능이 분리되었다. </para>
		<para>어플리케이션의 로그 정책을 관리하기 위해서 'log4j.xml' 항목의 우측 아이콘을 클릭한다.
			<mediaobject>
				<imageobject role="html">
					<imagedata fileref="../image/logmanager/logmanager024.jpg" align="center" />
				</imageobject>
				<imageobject role="fo">
					<imagedata fileref="../image/logmanager/pdf/logmanager024.jpg" align="center" />
				</imageobject>
			</mediaobject>
		</para>
		<para>Text Editor 기반의 로그 정책 관리를 수행할 지 GUI 기반의 로그 정책관리를 수행할지 선택할 수 있다. 단, 이 때 해당 어플리케이션의 Log Agent가 Active(=Online) 상태이어야 한다.
			<mediaobject>
				<imageobject role="html">
					<imagedata fileref="../image/logmanager/logmanager025.jpg" align="center" />
				</imageobject>
				<imageobject role="fo">
					<imagedata fileref="../image/logmanager/pdf/logmanager025.jpg" align="center" />
				</imageobject>
			</mediaobject>
		</para>
		<section>
			<title>GUI 기반의 정책관리</title>
			<para>GUI 기반의 로그정책관리 화면은 log4j framework의 명세를 기반으로 구현되어 있으며, 사용빈도가 낮은 일부 명세에 대한 지원은 제공하지 않을 수 있으므로 이러한 경우에는 text 기반 UI를 사용하여 로그 정책을 관리할 수 있다.</para>
      		<para>화면은 섹션별로 아코디언 형식의 UI를 제공하고 있으며, 각각 Root Logger, Appender, Logger(s) 등으로 각 섹션을 구분하여 표시한다.</para>
      		<para>각각의 섹션은 기본적으로 섹션 내 하단 버튼을 이용하여 하위 구성요소를 추가하거나 섹션 자체를 삭제할 수 있으며, 각 하위 구성요소들은 우측의 아이콘들을 통해 자신들을 수정/삭제할 수 있다.</para>
      		<section>
				<title>Root Logger</title>
				<para>Root Logger는 삭제가 불가능하며 로그 레벨을 변경하거나, appender-ref를 추가/변경/삭제할 수 있다.</para>
	      		<para>appender-ref는 현재 화면 상에 등록된 appender를 기준으로 select box 형태로 표시되며, 이미 참조된 appender는 선택이 불가능하도록 되어있다.</para>
	      		<mediaobject>
					<imageobject role="html">
						<imagedata fileref="../image/logmanager/logmanager027.jpg" align="center" />
					</imageobject>
					<imageobject role="fo">
						<imagedata fileref="../image/logmanager/pdf/logmanager027.jpg" align="center" />
					</imageobject>
					<caption>Root Logger Info. Section</caption>
				</mediaobject>
			</section>
			<section>
				<title>Appender</title>
				<para>Appender는 하단의 'Add Appender' 버튼을 클릭하여 추가할 수 있다.</para>
	      		<para>등록된 Appender는 자신의 삭제 및 Class 요소의 수정, Param 요소의 추가/수정/삭제가 가능하여, Appender의 Layout에 대해서 다시 Class 요소를 수정하고 Param 요소를 추가/수정/삭제할 수 있다.</para>
	      		<para>
	      			<mediaobject>
						<imageobject role="html">
							<imagedata fileref="../image/logmanager/logmanager031.jpg" align="center" />
						</imageobject>
						<imageobject role="fo">
							<imagedata fileref="../image/logmanager/pdf/logmanager031.jpg" align="center" />
						</imageobject>
						<caption>Appender Info. Section</caption>
					</mediaobject>
				</para>
	      		<para>
	      			<mediaobject>
						<imageobject role="html">
							<imagedata fileref="../image/logmanager/logmanager028.jpg" align="center" />
						</imageobject>
						<imageobject role="fo">
							<imagedata fileref="../image/logmanager/pdf/logmanager028.jpg" align="center" />
						</imageobject>
						<caption>Appender Regist Form</caption>
					</mediaobject>
				</para>
				<itemizedlist>
					<listitem><para>ConsoleAppender : 가장 기본적으로 제공되는 Console 화면에 로그를 출력하는 Appender, Root Logger의 Appeneder로 많이 사용된다.
						<mediaobject>
							<imageobject role="html">
								<imagedata fileref="../image/logmanager/logmanager034.jpg" align="center" />
							</imageobject>
							<imageobject role="fo">
								<imagedata fileref="../image/logmanager/pdf/logmanager034.jpg" align="center" />
							</imageobject>
						</mediaobject>
					</para></listitem>
					<listitem><para>DaillyRollingFileAppender : 정해진 DatePattern에 따라 log file을 rolling 하는 appender, file로 로그를 남기는 file appender이므로 Log Manager Patternlayout을 사용가능함.
						<mediaobject>
							<imageobject role="html">
								<imagedata fileref="../image/logmanager/logmanager035.jpg" align="center" />
							</imageobject>
							<imageobject role="fo">
								<imagedata fileref="../image/logmanager/pdf/logmanager035.jpg" align="center" />
							</imageobject>
						</mediaobject>
					</para></listitem>
					<listitem><para>RollingFileAppender : 정해진 file size에 따라 log file을 rolling 하는 appender, file appender이므로 역시 Log Manager Patternlayout을 사용가능함.
						<mediaobject>
							<imageobject role="html">
								<imagedata fileref="../image/logmanager/logmanager036.jpg" align="center" />
							</imageobject>
							<imageobject role="fo">
								<imagedata fileref="../image/logmanager/pdf/logmanager036.jpg" align="center" />
							</imageobject>
						</mediaobject>
					</para></listitem>
					<listitem><para>MongoDBAppender : Anyframe 에서 제공하는 appender로서 Anyframe Log Manager Plugin을 설치하면 사용가능하다. MongoDB에 직접 로그데이타를 저장하므로 db정로를 설정하여야 하며, conversion pattern은 MongoDB에서 사용하는 BSON(Binary JSON) 형식으로 작성하여야 한다.
						<mediaobject>
							<imageobject role="html">
								<imagedata fileref="../image/logmanager/logmanager037.jpg" align="center" />
							</imageobject>
							<imageobject role="fo">
								<imagedata fileref="../image/logmanager/pdf/logmanager037.jpg" align="center" />
							</imageobject>
						</mediaobject>
					</para></listitem>
					<listitem><para>PatternLayout for Log Manager : 로그 데이타를 MongoDB에 직접 저장하지 않고 파일 형태로 1차 저장 후 별도로 로그를 수집해야 하는 경우(=Log Agent Service의 로그 수집기능을 사용하는 경우) 이 Patternlayout을 선택해야만 올바른 정보가 MongoDB에 저장된다.
						<itemizedlist>
							<listitem><para>ConversionPattern : 로그 데이타가 파일로 저장될 때의 로그 패턴</para></listitem>
							<listitem><para>ColumnDelimiter : ascii 코드값으로 열(column)단위의 정보를 구분짓기 위해 설정, 설정하지 않을 경우 default는 "|"</para></listitem>
							<listitem><para>RowDelimiter : ascii 코드값으로 행(row)단위의 정보를 구분짓기 위해 설정, 설정하지 않을 경우 default는 "^"</para></listitem>
							<listitem><para>JsonPattern : 파일로 저장된 데이타를 MongoDB에 저장을 위한 변환 패턴, 각 숫자는 ConversionPattern에서 정의된 저장항목의 순서를 가리키며, 1부터 시작하여 10부터는 앞에 '.'을 추가하여 해석 오류를 방지한다.</para></listitem>
							<listitem><para>TimestampIndex : ConversionPattern에서 timestamp 정보가 저장된 순서를 가리킨다.</para></listitem>
							<listitem><para>TimestampDatePattern : text 형태로 저장된 timestamp 정보를 Date 객체로 변환하기 위한 timestamp text format 정보이다.</para></listitem>
						</itemizedlist>
						<para>
							<mediaobject>
								<imageobject role="html">
									<imagedata fileref="../image/logmanager/logmanager038.jpg" align="center" />
								</imageobject>
								<imageobject role="fo">
									<imagedata fileref="../image/logmanager/pdf/logmanager038.jpg" align="center" />
								</imageobject>
							</mediaobject>
						</para>
					</para></listitem>
				</itemizedlist>
			</section>
			<section>
				<title>Logger</title>
				<para>Logger는 하단의 'Add Logger' 버튼을 클릭하여 추가할 수 있다</para>
	      		<para>등록된 Logger는 자신의 삭제 및 Additivity, Level 의 수정과 Appender-Ref의 추가/수정/삭제가 가능하다.</para>
	      		<para>단, Logger의 등록 시에는 Appender-Ref의 설정이 불가능하며, 등록 후 해당 Logger의 수정을 통하여 작업이 가능함을 주의하기 바란다.</para>
	      		<para>
	      			<mediaobject>
						<imageobject role="html">
							<imagedata fileref="../image/logmanager/logmanager030.jpg" align="center" />
						</imageobject>
						<imageobject role="fo">
							<imagedata fileref="../image/logmanager/pdf/logmanager030.jpg" align="center" />
						</imageobject>
						<caption>Logger Info Section</caption>
					</mediaobject>
					
				</para>
	      		<para>
	      			<mediaobject>
						<imageobject role="html">
							<imagedata fileref="../image/logmanager/logmanager029.jpg" align="center" />
						</imageobject>
						<imageobject role="fo">
							<imagedata fileref="../image/logmanager/pdf/logmanager029.jpg" align="center" />
						</imageobject>
						<caption>Logger Regist Form</caption>
					</mediaobject>
				</para>
			</section>
		</section>
		<section>
			<title>Text 기반의 정책관리</title>
			<para>
				<mediaobject>
					<imageobject role="html">
						<imagedata fileref="../image/logmanager/logmanager026.jpg" align="center" />
					</imageobject>
					<imageobject role="fo">
						<imagedata fileref="../image/logmanager/pdf/logmanager026.jpg" align="center" />
					</imageobject>
				</mediaobject>
			</para>
			<para>사용자가 Log4j Framework 및 log4j.xml에 대하여 기본적인 지식을 가지고 있으며, 원격지의 어플리케이션에 대하여 GUI 기반 정책관리에서 할 수 없는 보다 상세한 작업을 수행하려고 할 경우 
Text 기반의 로그정책관리를 수행할 수 있다.</para>
			<para>로그정책을 직접 수정하고 'Save' 버튼을 클릭하면 Log Agent Service에 의하여 수정한 내용이 그대로 저장된다.</para>
			<para>만약 해당 어플리케이션이 실시간으로 로그 정책을 변경가능하다면, 수정한 내용을 저장한 즉시 반영될 것이다. 그렇지 않다면, 어플리케이션 재시작 등의 방법을 통하여 변경된 로그정책을 반영할 수 있다.</para>
		</section>
	</section>
	<warning>
		<title>Log Agent 상태에 따른 어플리케이션 관리기능의 제한</title>
		<para>Log Application 을 등록/수정하기 위해서는 해당 어플리케이션을 관리해줄 Log Agent Service가 Online(=Active) 상태여야 한다.</para>
		<para>따라서 Log Agent Service가 Online 상태가 아닌 경우에는 로그정책관리 등의 Application 관리기능의 상당부분이 제한된다.</para>
		<para>
			<mediaobject>
				<imageobject role="html">
					<imagedata fileref="../image/logmanager/logmanager039.jpg" align="center" />
				</imageobject>
				<imageobject role="fo">
					<imagedata fileref="../image/logmanager/pdf/logmanager039.jpg" align="center" />
				</imageobject>
			</mediaobject>
		</para>
	</warning>
	<note>
		<title>로그 정책 변경 시 실시간 반영</title>
		<para>Anyframe Log Manager Plugin을 설치하게 되면 해당 로그에 대한 정책설정을 주기적으로 watch 하도록 Application 설정이 변경된다.</para>
		<para>또한 Log Manager Web 모듈에서 로그 정책을 수정하게 되면 실제로 해당 로그 어플리케이션의 log4j.xml이 변경되며, 결과적으로 변경된 로그 정책이 실시간으로 반영되게 된다.</para>
	</note>
	<note>
		<title>Text UI의 활용</title>
		<para>GUI 편집기는 다소 어려울 수 있는 log4j 관련 설정을 템플릿 기반으로 쉽게 설정하고 변경할 수 있도록 하고 있다.</para>
		<para>다만, log4j의 모든 기능을 다 제공하고 있지는 않기에 보다 상세한 설정을 위해서는 GUI 편집기로 기본적인 설정을 하고 text UI를 사용해서 상세설정을 보강하는 방법을 권장한다.</para>
	</note>
	<warning>
		<title>어플리케이션 설정 변경 후 Log Agent Service 반영</title>
		<para>Log Application의 설정을 변경한 후에는 Log Agent Service를 재시작 하거나 Log Agent Service Management 화면에서 해당 Agent Service를 <link linkend="agent_service_restart">'Restart'</link> 해 주어야만 변경된 정보가 반영된다.</para>
	</warning>
</chapter>